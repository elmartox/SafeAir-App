<div class="recovery-bg">
  <header class="header">
    <div class="logo">SafeAir</div>
    <nav class="nav-tabs">
      <a routerLink="/" routerLinkActive="active" class="tab">Inicio</a>
      <a routerLink="/registro" routerLinkActive="active" class="tab">Registro</a>
      <a routerLink="/login" routerLinkActive="active" class="tab">Iniciar Sesión</a>
    </nav>
  </header>

  <main class="recovery-container">

    <!-- PASO 1: EMAIL -->
    <div *ngIf="step === 1 && !isSessionEmail" class="recovery-step">
      <div class="recovery-icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="8" y="8" width="32" height="32" rx="8" stroke="#14B8A6" stroke-width="3"/>
        </svg>
      </div>

      <div class="recovery-title">Recuperar Contraseña</div>
      <div class="recovery-sub">Ingresa tu correo registrado</div>

      <div *ngIf="errorMessage" class="error-message">
         {{ errorMessage }}
      </div>

      <form (ngSubmit)="continueWithEmail($event)" class="recovery-form">
        <div class="input-group">
          <input
            type="email"
            class="input-field"
            placeholder="Email"
            [(ngModel)]="email"
            name="email"
            required
          />
        </div>

        <button type="submit" class="recovery-btn">
          Continuar
        </button>
      </form>

      <div class="recovery-link">
        <a routerLink="/login" class="link-back">Volver a iniciar sesión</a>
      </div>
    </div>

    <!-- PASO 2: NUEVA CONTRASEÑA -->
    <div *ngIf="step === 2" class="recovery-step">
      <div class="recovery-icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <rect x="10" y="20" width="28" height="16" rx="2" stroke="#14B8A6" stroke-width="2"/>
        </svg>
      </div>

      <div class="recovery-title">Nueva Contraseña</div>
      <div class="recovery-sub">Para {{ email }}</div>

      <div *ngIf="errorMessage" class="error-message">
         {{ errorMessage }}
      </div>

      <form (ngSubmit)="resetPassword($event)" class="recovery-form">

        <div class="input-group">
          <input
            [type]="showPassword1 ? 'text' : 'password'"
            class="input-field"
            placeholder="Nueva contraseña"
            [(ngModel)]="newPassword"
            name="newPassword"
            required
          />
          <button type="button" class="toggle-password"
            (click)="showPassword1 = !showPassword1">
            
          </button>
        </div>

        <div class="input-group">
          <input
            [type]="showPassword2 ? 'text' : 'password'"
            class="input-field"
            placeholder="Confirmar contraseña"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            required
          />
          <button type="button" class="toggle-password"
            (click)="showPassword2 = !showPassword2">

          </button>
        </div>

        <div class="password-requirements">
          <ul>
            <li [class.met]="hasLetters">✓ Al menos una letra</li>
            <li [class.met]="hasNumbers">✓ Al menos un número</li>
            <li [class.met]="hasMinLength">✓ Mínimo 6 caracteres</li>
          </ul>
        </div>

        <button
          type="submit"
          class="recovery-btn"
          [disabled]="loading || !isPasswordValid()">
          {{ loading ? 'Actualizando...' : 'Actualizar contraseña' }}
        </button>
      </form>

      <div class="recovery-link">
        <button (click)="goBack()" class="link-back">Volver</button>
      </div>
    </div>

    <!-- PASO 3: ÉXITO -->
    <div *ngIf="step === 3" class="recovery-step success-step">
      <div class="recovery-icon success-icon">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <circle cx="24" cy="24" r="16" fill="#10B981"/>
          <path d="M16 24l4 4 12-12" stroke="#fff" stroke-width="3"/>
        </svg>
      </div>

      <div class="recovery-title">¡Listo!</div>
      <div class="recovery-sub">{{ successMessage }}</div>

      <a routerLink="/login" class="recovery-btn">
        Ir a Iniciar Sesión
      </a>
    </div>

  </main>
</div>

